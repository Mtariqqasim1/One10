<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout | One10</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Jost', sans-serif; }
        body { padding-bottom: 90px; }
        header { position: fixed; top: 0; left: 0; width: 100%; padding: 15px 0; background: rgba(255,255,255,0.95); border-bottom: 1px solid #eee; text-align: center; z-index: 1000; }
        .logo { font-size: 24px; font-weight: 800; letter-spacing: 3px; text-decoration: none; color: black; }
        
        .container { max-width: 600px; margin: 0 auto; padding: 100px 20px 20px; }
        .cart-item { display: flex; gap: 15px; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .c-img { width: 70px; height: 90px; }
        .c-img img { width: 100%; height: 100%; object-fit: cover; border-radius: 5px; }
        
        input { width: 100%; padding: 15px; margin-bottom: 15px; border: 1px solid #ddd; outline: none; }
        .btn-co { background: black; color: white; width: 100%; padding: 15px; border: none; font-weight: 700; text-transform: uppercase; cursor: pointer; }
        
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-top: 1px solid #eee; display: flex; justify-content: space-around; padding: 12px 0; }
        .nav-icon { font-size: 24px; color: #555; text-decoration: none; position: relative; }
        .nav-icon.active { color: black; }
        .cart-badge { background: #000; color: #fff; font-size: 10px; width: 16px; height: 16px; border-radius: 50%; position: absolute; top: -5px; right: -5px; display: flex; justify-content: center; align-items: center; }
    </style>
</head>
<body>
    <header><a href="index.html" class="logo">ONE10</a></header>

    <div class="container">
        <h2 style="text-align:center; text-transform:uppercase; margin-bottom:30px;">Your Cart</h2>
        <div id="cart-list"></div>
        
        <div style="display:flex; justify-content:space-between; font-weight:700; margin: 30px 0; font-size:18px;">
            <span>Total</span><span id="total">Rs. 0</span>
        </div>

        <h3 style="margin-bottom:20px; text-transform:uppercase; font-size:14px;">Shipping Details</h3>
        <form onsubmit="placeOrder(event)">
            <input type="text" id="name" placeholder="Full Name" required>
            <input type="tel" id="phone" placeholder="Phone Number" required>
            <input type="text" id="addr" placeholder="Full Address" required>
            <button class="btn-co">Confirm via WhatsApp</button>
        </form>
        <button onclick="clearCart()" style="color:red; background:none; border:none; margin-top:15px; font-size:12px; cursor:pointer;">Clear Cart</button>
    </div>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-icon"><i class="ri-home-line"></i></a>
        <a href="search.html" class="nav-icon"><i class="ri-search-line"></i></a>
        <a href="checkout.html" class="nav-icon active"><i class="ri-shopping-bag-fill"></i><div class="cart-badge" id="cart-count">0</div></a>
    </nav>

    <script>
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        updateUI();

        function updateUI() {
            document.getElementById('cart-count').innerText = cart.length;
            const list = document.getElementById('cart-list');
            let total = 0;
            
            if(cart.length === 0) list.innerHTML = "<p style='text-align:center; color:#999;'>Cart is empty</p>";
            else {
                list.innerHTML = cart.map((item, i) => {
                    total += item.price;
                    return `
                    <div class="cart-item">
                        <div class="c-img"><img src="${item.img}"></div>
                        <div style="flex:1;">
                            <h4 style="font-size:14px; margin-bottom:5px;">${item.name}</h4>
                            <p style="font-size:12px; color:#666;">Size: ${item.size}</p>
                            <p style="font-weight:600;">Rs. ${item.price.toLocaleString()}</p>
                        </div>
                        <i class="ri-delete-bin-line" onclick="remove(${i})" style="color:red; cursor:pointer;"></i>
                    </div>`;
                }).join('');
            }
            document.getElementById('total').innerText = "Rs. " + total.toLocaleString();
        }

        function remove(i) {
            cart.splice(i, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateUI();
        }

        function clearCart() {
            cart = [];
            localStorage.setItem('cart', JSON.stringify([]));
            updateUI();
        }

        // --- NEW SECURE ORDER FUNCTION ---
        function placeOrder(e) {
            e.preventDefault();
            if(cart.length === 0) return alert("Cart is empty");
            
            // 1. Get Data
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const addr = document.getElementById('addr').value;
            
            // 2. Calculate Total (Internal Calculation)
            const totalAmount = cart.reduce((acc, item) => acc + item.price, 0);
            
            // 3. Create Item List String
            const items = cart.map(i => `â€¢ ${i.name} (${i.size})`).join('%0A'); // %0A is New Line
            
            // 4. GENERATE SECURITY TOKEN
            const orderID = Math.floor(100000 + Math.random() * 900000); // 6 Digit Random ID
            const rawString = `ID:${orderID}-AMT:${totalAmount}`;
            const secureToken = btoa(rawString); // Base64 Encoding

            // 5. Create WhatsApp Message
            const msg = `*NEW ORDER ALERT ðŸ“¦*
---------------------
*Order ID:* #${orderID}
*Name:* ${name}
*Phone:* ${phone}
*Address:* ${addr}
---------------------
*Items:*
${items}
---------------------
*Total Bill:* Rs. ${totalAmount.toLocaleString()}
---------------------
ðŸ”’ *Security Token:* 
${secureToken}
_(Do not edit this code)_`;

            // 6. Send to Shopkeeper (Updated Number)
            const myNumber = "923253209977"; 
            window.open(`https://wa.me/${myNumber}?text=${encodeURIComponent(msg)}`, '_blank');
            
            // Cart Clear option (Optional)
            // clearCart();
        }
    </script>
</body>
</html>